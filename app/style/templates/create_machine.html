{% extends "base.html" %}

{% block title %}Create Machine{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-card">
        <h1 class="form-heading">Create New Machine</h1>

        <!-- Form now uses a vertical stack -->
        <div class="form-stack">

            <!-- Name Field -->
            <div class="form-group">
                <label for="name" class="form-label required">Name</label>
                <input data-bind="machine_create_name" type="text" id="name" name="name" class="form-input" placeholder="e.g. Mr. Wonderful" required>
            </div>

            <!-- Joined Condition Selector -->
            <div class="form-group">
                <label for="joined_condition" class="form-label required">Joined Condition</label>
                <select data-bind="machine_create_joined_condition" id="joined_condition" name="joined_condition" class="form-input" required>
                    <option value="5" selected>5 - Excellent</option>
                    <option value="4">4 - Good</option>
                    <option value="3">3 - Fair</option>
                    <option value="2">2 - Poor</option>
                    <option value="1">1 - Needs Repair</option>
                    <option value="0">0 - Decommissioned</option>
                </select>
            </div>

            <!-- Special Note Field -->
            <div class="form-group">
                <label for="special_note" class="form-label">Special Note</label>
                <textarea data-bind="machine_create_special_note" id="special_note" name="special_note" class="form-input" rows="4" placeholder="e.g. This is a awesome machine!"></textarea>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button class="btn btn-secondary"
                data-on-click="$showjson = !$showjson"
                >JSON</button>
                <button type="reset" class="btn btn-secondary"
                data-on-click="$machine_create_name = '', $machine_create_special_note = '', $machine_create_joined_condition = 5"
                >Reset</button>
                <button class="btn btn-primary" 
                data-on-click="@post('/api/machines/create/', { filterSignals : '/^machine_create_.*/'}), $machine_create_name = '', $machine_create_special_note = '', $machine_create_joined_condition = 5"
                data-on-datastar-fetch="
                    evt.detail.type === 'started' && @setAll(false, {include: /^(machine_failed|machine_success)$/}),
                    evt.detail.type === 'error' && @setAll(true, {include: /^machine_failed$/}),
                    evt.detail.type === 'finished' && !$machine_failed && @setAll(true, {include: /^machine_success$/})
                ">
                Create Machine
                </button>
            </div>
            <pre data-signals="{showjson: false}" data-json-signals="{include: /^machine_create_.*/}" data-show="$showjson" style="display: none" class="json-code-block">

            </pre>
            <!-- Error Message -->
            <div data-signals="{machine_failed: false}" data-show="$machine_failed" style="display: none" class="form-error">
                <p>Failed to create machine. Please try again.</p>
            </div>
            <!-- Success Message -->
            <div data-on-interval__duration.10s="$machine_success = false" data-signals="{machine_success: false}" data-show="$machine_success" style="display: none" class="form-success">
                <p>Successfully created machine.</p>
            </div>


        </div>
    </div>
</div>
{% endblock %}